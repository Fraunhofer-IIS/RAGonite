{
    "id": "confluence-151",
    "title": "XT Xen 4.3.4 Patch Queue",
    "url": "https://openxt.atlassian.net/wiki/spaces/DC/pages/14844024/XT+Xen+4.3.4+Patch+Queue",
    "content": "<p>Owned by Martin Osterloh\nLast updated: Sep 25, 2015 by Martin Osterloh\n\n</p><h2>Notes</h2><p>This is a list of the current (09/25/2015) Xen 4.3.4 patch queue. This should work well as a starting point for upgrading Xen to 4.6.x.</p><h2>Backports</h2><pre>bp-ept-update-aa9114edd97b292cd89b3616e3f2089471fd220.patch</pre><p>Adds passing of vpu and domain for various MTRR type setting in hvm_msr_write_intercept(). Also added EXIT_REASON_EPT_MISCONFIG exit handler.</p><h2>HVM Support</h2><pre>hvmloader_print_e820.patch</pre><p>Support for e820 printing.</p><p> </p><pre>hvmloader-vga-command-io.patch</pre><p>Enable IO since VGA needs it.</p><p> </p><pre>hvm-pm-hibernate-s-state.patch</pre><p>Changed PM1a_CNT.SLP_TYP and PM1b_CNT.SLP_TYP from 0x0 to 0x6 definition block to mach piix emulation.</p><p> </p><pre>hvm-pm-s-states.patch</pre><p>Adds xc_set_hvm_pio() and corresponding do_hvm_op() case. Added SCI_MASK which masks off bits in PM1a_STS that can generate an SCI. Added int pm_pio_set().</p><p> </p><pre>hvm-rtc.patch</pre><p>Updates guest domains real-time clock</p><p> </p><pre>hvm-rtc-refresh-time.patch</pre><p>Refreshes current time via gmtime()</p><h2>General/Graphic Pass-Through</h2><pre>gpt-igd-hp-resume-workaround.patch</pre><p>workaround host S3 resume issue on HP laptops. Turns out saving iGfx bars during iommu suspend and restoring them in iommu resume will fix the hang/reset during host resume on HP laptops. Following does that as a fallback on systems that doesn't have the firmware fix to save/restore iGfx bars.</p><p> </p><pre>gpt-iommu-mapping.patch</pre><p>Add hypercalls for iommu mapping (iommu_map_batch, iommu_x_mapping).</p><p> </p><pre>gpt-nvidia.patch</pre><p>For NVIDIA VGA cards load std vga BIOS image</p><pre> </pre><pre>gpt-quiet-log.patch</pre><p>comments out print statement</p><p> </p><pre>gpt-s3-resume-reason.patch</pre><p>Set power button status (necessary for proper win32 resume). Additionally,set rsm/wak_sts bit. set rsm/wak_sts bit.</p><p> </p><pre>gpt-superblanker.patch<br/>16M for superblanker FB. e820 address = 0xfd000000, type = E820_RESERVED.</pre><h2>ACPI emulation/ pass-through</h2><pre>acpi-no-hotplug.patch</pre><p>Remove pci hotplug from ACPI DSDT tables (_EJ0).</p><p> </p><pre>prune-acpi-devices.patch</pre><p>Comments out name decoding for FD and SPKR.</p><p> </p><pre>prune-vga-acpi-dev.patch</pre><p>(Presumably) removed support for VGA S3 suspend/resume work in Windows XP/2003.</p><p> </p><pre>qemu-acpi-tables.patch</pre><p>Makefile lists qemu_utils.c as source file. \"Fixes\" up ACPI headers. Added population of Qemu tables.</p><h2>Hypercalls</h2><pre>xc-xt-allow-pat-cacheattrs-for-all-domains.patch</pre><p>Allows PAT cache attributes for all domains.</p><p> </p><pre>xc-xt-aperture-map.patch</pre><p>Add an hypercall to map guest pages within an aperture in its own address space (modifying the p2m).</p><p> </p><pre>xc-xt-cpuid.patch</pre><p>Make cpuid ours: Hide core/HT topology, make vcpu appear as multicores, leave FEATURE_MWAIT, put our signature.</p><p> </p><pre>xc-xt-ept-respect-cacheattr-pin.patch</pre><p>Ignore PAT memory type for cache-pinned pages.</p><p> </p><pre>xc-xt-foreign-batch-cacheattr.patch</pre><p>Implement translation of a list of gpfn to a list of mfn in new hypercalls: XENMEM_translate_gpfn_list &amp; XENMEM_release_mfn_list. Typically used to get framebuffer's mfns of the gpfns we receive from the graphic emulation (ioemu/xengfx).</p><p> </p><pre>xc-xt-hvm-get-time.patch</pre><p>Add HVMOP_get_time handler to xenctrl library. add_hvmop_get_time_to_xc_tools.</p><p> </p><pre>xc-xt-hvm-info.patch</pre><p>Primitive tool for our toolstack to report VTd/VTx handling.</p><p> </p><pre>xc-xt-hvmloader-legacy-seabios-optionroms.patch</pre><p>Removed seabios-dir from Makefile subdirectory list. Added seabios_load_roms()</p><p> </p><pre>xc-xt-hvmloader-move-reservation-area.patch</pre><p>Moved reserved memory area end from 0xFE000000 to 0xFD000000.</p><p> </p><pre>xc-xt-interrupt-debug-info.patch</pre><p>Dumps LAPICs and IOAPICs status of HVM domains in key-handle 'i' (\"dump interrupt bindings\"). fix-irq-debug-key, dump-lapic.</p><p> </p><pre>xc-xt-isa-irq-guest-binding.patch</pre><p>Add ISA IRQ binding capability for guests. isa-irq-guest-binding.</p><p> </p><pre>xc-xt-local-pxe-rom.patch</pre><p>Makefile change to accomodate for local PXE ROM.</p><p> </p><pre>xc-xt-opt-disable-vmcs-shadowing.patch</pre><p>Optionally disable VMCS shadowing.</p><p> </p><pre>xc-xt-parse-video-from-mbi.patch</pre><p>Read the VBE from Multiboot information table given by the bootloader.</p><p>parse-video-from-mbi.</p><p> </p><pre>xc-xt-set-servicevm.patch</pre><p>Add set_xcisrv hypercall for dom0 to declare a VM as service VM (restricted privileges).</p><p> </p><pre>xc-xt-shadow-op-blow-tables.patch</pre><p>Add an hypercall to blow shadow tables of a domain (unpining them before if necessary).</p><p> </p><pre>xc-xt-tboot-shutdown-disable-irqs.patch</pre><p>tboot_shutdown is disabling interrupts a bit early. tboot-shutdown-disable-irqs.</p><p> </p><pre>xc-xt-tools-v3-mapspace-workaround.patch</pre><p>Defines XENMAPSPACE_gmfn_range to 100 (prev 3). Apparently to accomodate for bug in old XT tools. Thus, XENMAPSPACE_gmfn_range has to be moved to another ID.</p><p> </p><pre>xc-xt-txt-shutdown-acpi-access-width.patch</pre><p>Fixes incorrect ACPI tables on some Dell platforms (980) that corrupt power operations with TXT enabled.</p><p> </p><pre>xc-xt-unmap-shared-info.patch</pre><p>Add a way for XENMAPSPACE_shared_info hypercall to unmap the shared info page (used before going S4).</p><p> </p><pre>xc-xt-v4v.patch</pre><p>V4V, domain to domain communication protocol, through __HYPERVISOR_v4v_op hypercall (V4V, V4V_Hypervisor_API).</p><p> </p><pre>xc-xt-v4v-viptables.patch</pre><p>V4V implementation of viptables to filter traffic.</p><p> </p><pre>xc-xt-vcpu-get-time.patch</pre><p>Add VCPUOP_get_time to make NOW() macro available in PV guests.</p><p> </p><pre>xc-xt-xenconsoled-syslog.patch</pre><p>An ugly way to make xenconsoled log into syslog.</p><p> </p><pre>xc-xt-xenstore-use-pthread-always.patch</pre><p>Force libpthread as libxenstore does not work without it.</p><p> </p><pre>xc-xt-xen-translate.patch</pre><p>Implement translation of a list of gpfn to a list of mfn in new hypercalls: XENMEM_translate_gpfn_list &amp; XENMEM_release_mfn_list. Typically used to get framebuffer's mfns of the gpfns we receive from the graphic emulation (ioemu/xengfx).</p><h2>Xen Security Modules</h2><pre>flask-bool-utility-fix.patch</pre><p>Check to see if hypercall to bounce memory for flask op hypercall succeeded.</p><p> </p><pre>flask-persist-booleans.patch</pre><p>Added XSM_BOOLEAN_CONFIG_PATH. Used to write to persistent boolean file.</p><p> </p><pre>xsm-add-corespersocket.patch</pre><p>Added handling for adding cores on a socket basis (and its check for privileges).</p><h2>Block Tap Patches</h2><pre>blktap2-multi-coalesce.patch</pre><p>Huge patch. Added functionality to read from VHDs. This thing is huge.</p><p> </p><pre>blktap2-vci.patch</pre><p>This is huge as well. Lots of handling special cases for Windows.</p><p> </p><pre>blktap-instrumentation.patch</pre><p>Tapdisk control instrumentation such as read(), write(), select().</p><p> </p><pre>blktap-quieten-udevd.patch</pre><p>xen-backend.rules changed to use a SYMLINK=\"xen/%k\", MODE now deprecated.</p><p> </p><pre>blktap-resume-fix.patch</pre><p>Re-create the tapdisk driver stack as the path may have changed upon resume.</p><p> </p><pre>blktap-retry-fix.patch</pre><p>Changed vreq-&gt;blocked = treq.blocked; to vreq-&gt;blocked |= treq.blocked;</p><p> </p><pre>blktap-timeout.patch</pre><p>Added TAPCTL_SERVER_TIMEOUT to tap_ctl_connect_send_and_receive() [Currently 120].</p><h2>BIOS Patches</h2><pre>bios-signature.patch</pre><p>Fetch BIOS signature data passed by QEMU if any. Write required BIOS signature to BIOS text segment. Add any required BIOS signature. Add MP tables.</p><pre>bios-uuid.patch</pre><p>Added hypercall to set/get UUID for domains.</p><h2>Misc Patches</h2><pre>10ms_timeslice.patch</pre><p>changes the timeslice to 10ms from previously 30ms.</p><p> </p><pre>add-command-line-option-to-disable-arat.patch</pre><p>Added command line option to force ARAT (Always Running APIC TIMER) to off.</p><p> </p><pre>add-percentages-to-xenpm.patch</pre><p>Added eprcent-wise printing in print_cx_stat().</p><p> </p><pre>add_system_time_timestamps.patch</pre><p>console_us_timestamps: include a microsecond (us) timestamp prefix on every Xen console line.</p><p> </p><pre>cpufreq_gov_stop_avoid_panic.patch</pre><p>Checking for if this domain info enables CPUFREQ_GOV_STOP. If so, the timer exits.</p><p> </p><pre>crash_flag_hypercall.patch</pre><p>Adds crash flag to hypercalls.</p><p> </p><pre>dom0_auto_mem.patch</pre><p>Added maximum increase amount of pages for dom0.</p><p> </p><pre>evtchn-do-not-set-pending-if-s3.patch</pre><p>If domain is in S3 it will miss the notification, so check here.</p><p> </p><pre>fix-32bit-xsm-interface.patch</pre><p>Added XEN_GUEST_HANDLE and its 64-bit equivalent.</p><p> </p><pre>fix-memcpy-in-x86-emulate.patch</pre><p>Routine to make __hvm_copy appropriate to use for copying the results of instruction emulation back to guest memory - these typically require 64-bit, 32-bit and 16-bit writes to be atomic whereas memcpy is only atomic for 64-bit writes. This is still not 100% correct since copies larger than 64-bits will  not be atomic for the last 2-6 bytes but should be good enough for instruction emulation.</p><p> </p><pre>fix-pci-serial-hang.patch</pre><p>Fix for ns16550 chipset. IO seems to be wonky for that particular set of hardware.</p><p> </p><pre>fix-race-between-udev-and-tapctl.patch</pre><p>Fixes race condition between udev and tapctl.</p><p> </p><p>fix-write-clash.patch</p><p>Added undef's for READ and WRITE to shut the compiler up.</p><p> </p><pre>fix-xenctrl-enum-defn.</pre><p>Moved definition of enum xc_error_code from xenctrl.h.</p><p> </p><pre>include-seabios.patch</pre><p>Includes Seabios support for HVM loader.</p><p> </p><pre>incremental-dmesg-processing.patch</pre><p>Processing dmsg in increments.</p><p> </p><pre>iobitmap-on-all-vcpus.patch</pre><p>Per VCPU bitmap setting.</p><p> </p><pre>large-remap.patch</pre><p>Map into the current process the range of guest pages given by [pfn:pfn+num-1]. Mapping does not fail if some pages cannot be mapped. Instead we indicate any pages that cannot be mapped by setting the corresponding bit in err_bits. </p><p> </p><pre>libvhd-disable-static-batmaps.patch</pre><p>Commented out all static use of VCI batmaps.</p><p> </p><pre>local-ipxe.patch</pre><p>Patched Makefile to use local ipxe file.</p><p> </p><pre>microcode-info.patch</pre><p>pr_debug macro defined to actually do something (i.e. printing)</p><p> </p><pre>publish_xentrace_formats.patch</pre><p>Xentrace Makefile expanded to make its own directory and place files.</p><p> </p><pre>reboot-quirk-pci.patch</pre><p>Added handling for rebooting over PCI. Specifically, added handling of CF9 \"PCI reset register\".</p><p> </p><pre>rmrr-validate-range.patch</pre><p>Added sanity check to see if the end address is smaller than the base address. If so, print message</p><p>and return -EINVAL.</p><p> </p><pre>rombios-faster.patch</pre><p>Changed number of BX_MAX_ATA_INTERFACES from 4 to two and BX_MAX_ATA_DEVICES to 3.</p><p> </p><pre>sb_reboot_turbo_workaround.patch</pre><p>Added definition for MSR_SB_TURBO_CURRENT_LIMIT to be 0x000001ac.</p><p> </p><pre>smbios.patch</pre><p>Added \"Type 7 -- Cache Information\" and its associated tracing functions.</p><p> </p><pre>stack_on_triple_fault.patch</pre><p>Added vcpu_show_execution_state(v) upon triple fault.</p><p> </p><pre>stubdomain-msi-irq-access.patch</pre><p>Added allow/disallow functionality for stubdomains IRQ access.</p><p> </p><pre>tapdisk_debug.patch</pre><p>Added debug logging if !BLKIF_RSP_OKAY.</p><p> </p><pre>tapdisk-increase-vhd-req-pool.patch</pre><p>Size of vreq_free and vreq_list increased from VHD_REQS_DATA to VHD_REQS_TOTAL.</p><p> </p><pre>tapdisk_shutdown_recursion.patch</pre><p>Added checking for shutdown in progess and signaling to try again.</p><p> </p><pre>vbe-lfb-addr-matches-hvmloader.patch</pre><p>Moved physical address from VBE from 0xE0000000 to 0xF0000000</p><p> </p><pre>vhd-util-allow-resize.patch</pre><p>Added VCI_CHECK_CREATOR check before VHD manipulation.</p><p> </p><pre>vhd-validate-size.patch</pre><p>Added calculation of current VHD size, maximum is 2040GB.</p><p> </p><pre>workaround-nehalem-igd-vtd.patch</pre><p>Workaround fixing VT-d breakage on Clarkdale integrated graphics!</p><p> </p><pre>xen-allow-hvm.patch</pre><p>Allow HVM operation at all times, otherwise hvm_enable will be off if we boot without TBOOT and TXT is enabled in the BIOS.</p><p> </p><pre>xen-cpuidle-hang.patch</pre><p>Added get-max-cstate regarding the current C-state limitation. Added check to verify that dom0 is NOT using RTC interrupts.</p><p> </p><pre>xen-libhvm.patch</pre><p>Patches helepr library for reading ACPI and SMBIOS firmware values from the host system for use with the HVM guest firmware pass-through feature in Xen.</p><p> </p><pre>xenstored-instrumentation.patch</pre><p>Ignore noisy messages unless verbose specified.</p><p> </p><pre>xentrace-format-handle-zero-tsc.patch</pre><p>Use last TSC of none provided. Also, during initialization, take reltsc into account rather than just dividing by 1M.</p><p> </p>",
    "date": "2024-11-15",
    "disclaimer": "Users of this benchmark dataset are advised to check Atlassian’s official documentation for the most current information.",
    "space": "DC"
}