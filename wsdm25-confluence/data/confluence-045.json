{
    "id": "confluence-045",
    "title": "V4V firewall (viptables) rules",
    "url": "https://openxt.atlassian.net/wiki/spaces/DC/pages/36864019/V4V+firewall+(viptables)+rules",
    "content": "<p>Owned by Ross Philipson\nLast updated: Jan 22, 2019 by Jason Andryuk\n\n</p><p class=\"auto-cursor-target\"><br/></p><ac:structured-macro ac:macro-id=\"e51264a6-6cf2-48c6-ab9c-c4e2c07469d9\" ac:name=\"info\" ac:schema-version=\"1\"><ac:parameter ac:name=\"icon\">None</ac:parameter><ac:rich-text-body><p><ac:image ac:width=\"80\"><ri:attachment ri:filename=\"cc-by.png\" ri:version-at-save=\"1\"></ri:attachment></ac:image></p><p>Copyright 2016 by Assured Information Security, Inc. Created by Jean-Edouard Lejosne &lt;lejosnej@<a href=\"http://ainfosec.com/\">ainfosec.com</a>&gt;. This work is licensed under the Creative Commons Attribution 4.0 International License. To view a copy of this license, visit <a class=\"external-link\" href=\"http://creativecommons.org/licenses/by/4.0/\" rel=\"nofollow\">http://creativecommons.org/licenses/by/4.0/</a>.</p></ac:rich-text-body></ac:structured-macro><p><br/></p><p><ac:structured-macro ac:macro-id=\"9328a42d-e979-42c7-b008-b8beb2131468\" ac:name=\"toc\" ac:schema-version=\"1\"></ac:structured-macro></p><h2>Location</h2><p>V4V firewall rules for the different VM types (and their stubdoms) are defined in VM templates:</p><p><a href=\"https://github.com/OpenXT/manager/tree/master/templates/default\">https://github.com/OpenXT/manager/tree/master/templates/default</a></p><h2>Rule management</h2><p>The toostack sets the default rule to REJECT.</p><p>Since there is no notion of connection state in the Xen V4V code, for each VMA → VMB:port, we have to define 2 ACCEPT rules:</p><ul style=\"list-style-type: square;\"><li>VMA:* → VMB:port</li><li>VMB:port → VMA:*</li></ul><p>Note: \"*\" can now be replaced with a <span style=\"color: rgb(51,153,102);\">pre-defined port</span> (usually port + 10000) to make things safer.</p><p>When using a wildcard, if a malicious process in VMB manages to use \"port\" as its \"from\" port, then it can access all the VMA V4V services...</p><h2>Rules</h2><h3>DOM0</h3><ul style=\"list-style-type: square;\"><li>can talk to <strong>UIVM</strong> and <strong>NDVM</strong> <span style=\"color: rgb(51,153,102);\">from port <strong>12222</strong></span> to port <strong>2222</strong><br/>used for: sshv4v</li><li>can talk to <strong>NDVM</strong> <span style=\"color: rgb(51,153,102);\">from port <strong>15555</strong></span> to port <strong>5555</strong><br/>used for: dbus (probably network-master talking to network-slave)</li></ul><h3>UIVM</h3><ul style=\"list-style-type: square;\"><li>can talk to <strong>DOM0</strong> on port <strong>80</strong><br/>used for: the web UI</li><li>can talk to <strong>DOM0</strong> on port <strong>2222</strong><br/>used for: sshv4v (ctrl-shift-t)</li><li>can talk to <strong style=\"line-height: 1.42857;\">DOM0</strong> on port <strong style=\"line-height: 1.42857;\">4878</strong><br/>used for: icbinn</li><li><span style=\"line-height: 1.42857;\">can talk to </span><strong style=\"line-height: 1.42857;\">DOM0</strong><span style=\"line-height: 1.42857;\"> on port </span><strong style=\"line-height: 1.42857;\">5555</strong><br/>used for: dbus for UI scripts, see <a href=\"https://github.com/OpenXT/xenclient-oe/tree/master/recipes-openxt/xenclient/xenclient-uivm-xsessionconfig\">https://github.com/OpenXT/xenclient-oe/tree/master/recipes-openxt/xenclient/xenclient-uivm-xsessionconfig</a></li><li>can talk to <strong>DOM0</strong> on port <strong>8080</strong><br/>used for: special web UI requests</li><li>can talk to <strong>NDVM</strong> on port <strong>5555</strong><br/>used for: dbus (nm-applet talking to networkmanager)</li></ul><h3>NDVM</h3><ul style=\"list-style-type: square;\"><li>can talk to <strong>DOM0</strong> on port <strong>4878</strong><br/>used for: icbinn</li><li>can talk to <strong>DOM0</strong> on port <strong>5555</strong><br/>used for: dbus (network-slave talking to network-master?)</li></ul><h3>SYNCVM</h3><ul><li>can talk to <strong>DOM0</strong> on port <strong>4878</strong><br/>used for: icbinn and vhd-util env var LIBVHD_ICBINN_VHD_SERVER</li><li>can talk to <strong>DOM0</strong> on port <strong>4879</strong><br/>used for: vhd-util env var LIBVHD_ICBINN_KEY_SERVER</li><li>can talk to <strong>DOM0</strong> on port <strong>5556</strong><br/>used for: dbus (sync-client-daemon issuing dbus commands to xenmgr)</li></ul><h3>Regular guests</h3><p>Can't talk to anything</p><h3><span style=\"color: rgb(255,0,0);\"><span style=\"color: rgb(0,0,0);\">Stubdomains</span></span></h3><ul style=\"list-style-type: square;\"><li><p><span style=\"color: rgb(255,0,0);\"><span style=\"color: rgb(0,0,0);\">can talk to <strong>DOM0</strong> on port <strong>4001<br/></strong></span></span><span style=\"color: rgb(0,0,0);\">used for: dmbus service 1</span></p></li><li><p><span style=\"color: rgb(255,0,0);\"><span style=\"color: rgb(0,0,0);\">can talk to <strong>DOM0</strong> on port <strong>4002<br/></strong></span></span><span style=\"color: rgb(0,0,0);\">used for: dmbus service 2</span></p></li><li><p><span style=\"color: rgb(255,0,0);\"><span style=\"color: rgb(0,0,0);\">can talk to <strong>DOM0</strong> on port <strong>5000<br/></strong></span></span><span style=\"color: rgb(0,0,0);\">used for: atapi_pt_helper</span></p></li><li><p><span style=\"color: rgb(255,0,0);\"><span style=\"color: rgb(0,0,0);\">can talk to <strong>DOM0</strong> on port <strong>5001<br/></strong></span></span>used for: audio_helper</p></li><li>can talk to <strong>DOM0</strong> on port <strong>5100<br/></strong>used for: qmp_helper - proxy QEMU Machine Protocol (QMP) commands</li></ul><p><br/></p>",
    "date": "2024-11-15",
    "disclaimer": "Users of this benchmark dataset are advised to check Atlassian’s official documentation for the most current information.",
    "space": "DC"
}