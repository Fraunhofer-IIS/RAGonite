{
    "id": "confluence-013",
    "title": "Dealing with quilt",
    "url": "https://openxt.atlassian.net/wiki/spaces/DC/pages/20905986/Dealing+with+quilt",
    "content": "<p>Owned by Jed\nLast updated: May 07, 2018 by Jason Andryuk\n\n</p><p class=\"auto-cursor-target\"><br/></p><ac:structured-macro ac:macro-id=\"e51264a6-6cf2-48c6-ab9c-c4e2c07469d9\" ac:name=\"info\" ac:schema-version=\"1\"><ac:parameter ac:name=\"icon\">None</ac:parameter><ac:rich-text-body><p><ac:image ac:width=\"80\"><ri:attachment ri:filename=\"cc-by.png\" ri:version-at-save=\"1\"></ri:attachment></ac:image></p><p>Copyright 2016 by Assured Information Security, Inc. Created by Jean-Edouard Lejosne &lt;lejosnej@<a href=\"http://ainfosec.com\">ainfosec.com</a>&gt;. This work is licensed under the Creative Commons Attribution 4.0 International License. To view a copy of this license, visit <a class=\"external-link\" href=\"http://creativecommons.org/licenses/by/4.0/\" rel=\"nofollow\">http://creativecommons.org/licenses/by/4.0/</a>.</p></ac:rich-text-body></ac:structured-macro><h2>Quilt Setup</h2><p>Configure quilt to generate patches with less metadata by creating <code>~/.quiltrc</code> with the following content:</p><ac:structured-macro ac:macro-id=\"cb2324c3-b34e-44b6-ac8d-9be094f5c41d\" ac:name=\"code\" ac:schema-version=\"1\"><ac:plain-text-body><![CDATA[# Options passed to GNU diff when generating patches\nQUILT_DIFF_OPTS=\"--show-c-function\"\n\n# Options passed to GNU patch when applying patches.\nQUILT_PATCH_OPTS=\"--unified\"\n\n# Do not include index lines\nQUILT_NO_DIFF_INDEX=1\n# Do not include timestamps\nQUILT_NO_DIFF_TIMESTAMPS=1\n\n# Options to pass to commands (QUILT_${COMMAND}_ARGS)\n# Generate a/ b/ patches to cut down on churn\n#QUILT_DIFF_ARGS=\"--no-timestamps --color=auto -p ab\"\n#QUILT_REFRESH_ARGS=\"--no-timestamps --backup -p ab\"\nQUILT_DIFF_ARGS=\"--color=auto -p ab\"\nQUILT_REFRESH_ARGS=\"--backup -p ab\"\nQUILT_PUSH_ARGS=\"--color=auto\"\nQUILT_SERIES_ARGS=\"--color=auto\"\nQUILT_PATCHES_ARGS=\"--color=auto\"\nQUILT_NEW_ARGS=\"-p ab\"\n]]></ac:plain-text-body></ac:structured-macro><p>If you don't set the above options, you should run `<code>quilt refresh</code>` with additional command line arguments `<code>quilt refresh -p ab --no-timestamps --no-index</code>` when refreshing patches.  As we store patches in git, the reduced metadata makes a cleaner git history when we uprev software packages.</p><h2>Modifying an existing patch</h2><ul><li>in the following, replace &lt;recipe&gt; by the name of the recipe you want to modify</li><li>go to the work directory (`cd openxt/build/tmp-eglibc/work/*/&lt;recipe&gt;-*/*/`)</li><li>type `quilt` for a list of commands. `quilt applied`, for example, will show you all the patches that are currently applied, which should be all of them</li><li>find the patch you want to modify, say x.patch, and pop to it: `quilt pop x.patch`, that will unapply all the patches applied after (on top of) that one</li><li>add the file you want to modify to the patch: `quilt add file.c`</li><li>do the modifications you want. if you did the modifications before reaching this step, game over. run `./bb -c cleansstate &lt;recipe&gt; &amp;&amp; ./bb &lt;recipe&gt;` and start over</li><li>once you've modified the file, you `quilt refresh` to refresh the patch</li><li>then `quilt push -a` to make sure the part of the patchqueue you pop-ed earlier still applies</li><li>if your patch modification introduces a conflict or any fuzz to another patch, fix it</li><li>once you're done, overwrite the patch file in the xenclient-oe repository (openxt/build/repos/xenclient-oe/) with the newly modified one (under patches/ in the work directory)</li><li>then clean and rebuild the recipe: ./bb -c cleansstate recipe &amp;&amp; ./bb recipe</li><li>test the result. if all works, you can finally go to openxt/build/repos/xenclient-oe, commit and push to your xenclient-oe fork!</li></ul><p><br/></p>",
    "date": "2024-11-15",
    "disclaimer": "Users of this benchmark dataset are advised to check Atlassian’s official documentation for the most current information.",
    "space": "DC"
}