{
    "id": "confluence-138",
    "title": "XT xen patch-queue",
    "url": "https://openxt.atlassian.net/wiki/spaces/~rphilipson/pages/34799621/XT+xen+patch-queue",
    "content": "<p>Owned by Ross Philipson\nLast updated: Apr 27, 2016 by Ross Philipson\n\n</p><p><span class=\"mw-headline\"><ac:structured-macro ac:macro-id=\"21bd0ef9-2603-4838-9369-086a2bea4be7\" ac:name=\"toc\" ac:schema-version=\"1\"></ac:structured-macro><br/></span></p><h2><span class=\"mw-headline\">Port to 4.3.x Notes</span><span class=\"mw-editsection\"> </span></h2><h2><span class=\"mw-headline\">Patches breaking Open-Source Xen</span><span class=\"mw-editsection\"> </span></h2><p>xc-parse-video-from-mbi seems to be the only patch breaking an open-source setup of Xen (tested with a Linux wheezy testing distribution and a custom Linux kernel 3.8.13.7).</p><h2><span class=\"mw-headline\">Backports</span><span class=\"mw-editsection\"> </span></h2><h4><span class=\"mw-headline\">bp-intel-opregion</span><span class=\"mw-editsection\"> </span></h4><p>Support Intel opregion in hvmloader (the actual mapping is done in ioemu) (rev hg:3c864e04c2ad)</p><ul style=\"margin-left: 1.6em;\"><li>acpi-nvs-opregion</li><li>hvmloader-intel-opregion</li></ul><h4><span class=\"mw-headline\">bp-seabios-support</span><span class=\"mw-editsection\"> </span></h4><p>Support for SeaBIOS instead of rombios in hvmloader. Will be upstreamed with 4.2, there's a tone of patches for that ... /!\\ Our backport (actually the initial thing) included xengfx specific modifications.</p><ul style=\"margin-left: 1.6em;\"><li>seabios-support.</li></ul><h4><span class=\"mw-headline\">bp-xenstore-path-is-subpath</span><span class=\"mw-editsection\"> </span></h4><p>This utility function compares two paths, textually and reports whether one is a subpath (a child path) of the other. (<a href=\"http://xenbits.xen.org/xen.git\">xenbits.xen.org/xen.git</a>: 3607a75236b37abe350bf52f4700355be963a60d)</p><ul style=\"margin-left: 1.6em;\"><li>xenstore-add-xs-path-is-subpath</li></ul><h4><span class=\"mw-headline\">bp-xenstore-unwatch-fix</span><span class=\"mw-editsection\"> </span></h4><p>Filter watch events in libxenstore when we unwatch (<a href=\"http://xenbits.xen.org/xen.git\">xenbits.xen.org/xen.git</a>: b6372f16d3f1cf48cd2ff21ab4bdc25cc05d69fd)</p><ul style=\"margin-left: 1.6em;\"><li>xenstore-fix-unwatch</li></ul><h4><span class=\"mw-headline\">bp-track-dirty-vram-xsm-check</span><span class=\"mw-editsection\"> </span></h4><p>xsm/flask: Fix XSM support for HVMOP_track_dirty_vram</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=75c411d02b1b8eca02c97d32120ded0ce4146114\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=75c411d02b1b8eca02c97d32120ded0ce4146114</a></li></ul><h2><span class=\"mw-headline\">XSA</span><span class=\"mw-editsection\"> </span></h2><h4><span class=\"mw-headline\">bp-legacy-bridges-int-remap-validation</span><span class=\"mw-editsection\"> </span></h4><p>VT-d: Fix interrupt remapping source validation for devices behind legacy bridges. Using SVT_VERIFY_BUS here doesn't make sense; native Linux also uses SVT_VERIFY_SID_SQ. This is XSA-33.</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=739174dfee2bd5d0f6c30595cba0fd3c7b6103d5\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=739174dfee2bd5d0f6c30595cba0fd3c7b6103d5</a></li></ul><h4><span class=\"mw-headline\">bp-fix-sysenter-vulnerability</span><span class=\"mw-editsection\"> </span></h4><p>x86: clear EFLAGS.NT in SYSENTER entry path. This is XSA-44</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=584eb7c15e4c94baaba93468776572dd7373a33c\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=584eb7c15e4c94baaba93468776572dd7373a33c</a></li></ul><h4><span class=\"mw-headline\">bp-fix-irq-access-permission</span><span class=\"mw-editsection\"> </span></h4><p>x86: fix various issues with handling guest IRQs. This is XSA-46</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=d3d1288618ec903ad6a0e994ddfe0975cbac1584\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=d3d1288618ec903ad6a0e994ddfe0975cbac1584</a></li></ul><h4><span class=\"mw-headline\">bp-defer-evtchn-pointer-store</span><span class=\"mw-editsection\"> </span></h4><p>defer event channel bucket pointer store until after XSM checks. This is XSA-47</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=b10b4af626d95cd432576cad0e2f500769c1e002\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=b10b4af626d95cd432576cad0e2f500769c1e002</a></li></ul><h4><span class=\"mw-headline\">bp-*-preemptible</span><span class=\"mw-editsection\"> </span></h4><p>Make several long latency operations preemptible. This is XSA-45</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=7a93b9a11c99a88f293c3e1e3a79914b6d13b3aa\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=7a93b9a11c99a88f293c3e1e3a79914b6d13b3aa</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=06a68a09df243b175d1737a95df2e6f153cbae42\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=06a68a09df243b175d1737a95df2e6f153cbae42</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=210e61b80c29ef824f5fdc5946d6d876b8875fe3\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=210e61b80c29ef824f5fdc5946d6d876b8875fe3</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=c6fad967aabeb98da8307e59f73474b23b42f0d1\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=c6fad967aabeb98da8307e59f73474b23b42f0d1</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=02615aaefd5c6c5856b4f81799bb6ec1ca0d89d0\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=02615aaefd5c6c5856b4f81799bb6ec1ca0d89d0</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=09f9f72fa3dc2e239359741596fa349d8461cb50\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=09f9f72fa3dc2e239359741596fa349d8461cb50</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=8eb2e89bfad8d55d0ca770e2a0988c945b318e03\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=8eb2e89bfad8d55d0ca770e2a0988c945b318e03</a></li></ul><h4><span class=\"mw-headline\">bp-dont-permit-svt-no-verify</span><span class=\"mw-editsection\"> </span></h4><p>Fix VT-d interrupt remapping source validation issue. This is XSA-49</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4c45d2ddc991d5c4e80fc89eb4ad1120702c5ec1\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4c45d2ddc991d5c4e80fc89eb4ad1120702c5ec1</a></li></ul><h4><span class=\"mw-headline\">bp-fix-rcu-domain-locking</span><span class=\"mw-editsection\"> </span></h4><p>Fix rcu domain locking for transitive grants. This is XSA-50.</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=a12ed396652c22988e0e7a3f5bd57c882872da8e\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=a12ed396652c22988e0e7a3f5bd57c882872da8e</a></li></ul><h4><span class=\"mw-headline\">bp-fix-information-leak-on-amd-cpus</span><span class=\"mw-editsection\"> </span></h4><p>Fix information leak on AMD CPUs. This is XSA-52.</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=c3401c1aece47dc5388184c9b6a3527655d5bbdf\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=c3401c1aece47dc5388184c9b6a3527655d5bbdf</a></li></ul><h4><span class=\"mw-headline\">bp-recover-from-faults-on-xrstor</span><span class=\"mw-editsection\"> </span></h4><p>Recover from faults on XRSTOR. This is XSA-53.</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=5849504a03725f553195c8d80b0d595ef8334e2a\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=5849504a03725f553195c8d80b0d595ef8334e2a</a></li></ul><h4><span class=\"mw-headline\">bp-properly-check-guest-input-to-xsetbv</span><span class=\"mw-editsection\"> </span></h4><p>Properly check guest input to XSETBV. This is XSA-54.</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=13e00caf1a01a4eb99f2269be6ce12a3a4703178\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=13e00caf1a01a4eb99f2269be6ce12a3a4703178</a></li></ul><h4><span class=\"mw-headline\">bp-libelf-* and bp-libxc-*</span><span class=\"mw-editsection\"> </span></h4><p>Fix multiple vulnerabilities in libelf PV kernel handling. This is XSA-55.</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=64a0206c451920b72a9c5721a6f2427baf99e3dd\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=64a0206c451920b72a9c5721a6f2427baf99e3dd</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=bbf40e6b6d47809f4289a866d7d167c25104ecc0\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=bbf40e6b6d47809f4289a866d7d167c25104ecc0</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=f7fb94409c562beec06094141ef262dc85f28dac\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=f7fb94409c562beec06094141ef262dc85f28dac</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=e719b136b750e5eee87c4647d1846e4e1e70eac0\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=e719b136b750e5eee87c4647d1846e4e1e70eac0</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4d3339de1fe3cbf7b05487fdb6cadd7267950948\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4d3339de1fe3cbf7b05487fdb6cadd7267950948</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=de49d6e83c3a8c753646b007972140ddbb746ba8\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=de49d6e83c3a8c753646b007972140ddbb746ba8</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4e46085972d2367dff2345a73361c1c17b47ce73\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4e46085972d2367dff2345a73361c1c17b47ce73</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=8ce60b35beaac91a97b79c004ca6bf5d58e7390b\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=8ce60b35beaac91a97b79c004ca6bf5d58e7390b</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=39923542bb43e67776c4e8292d4a5a1adef2bd3b\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=39923542bb43e67776c4e8292d4a5a1adef2bd3b</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=9962d7ffcce97ec2d69a15ef861996b1ead33694\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=9962d7ffcce97ec2d69a15ef861996b1ead33694</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=44c74b1ed31c75ed9026abf62ab7427a46d8027a\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=44c74b1ed31c75ed9026abf62ab7427a46d8027a</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=bd3dba9f435fa59f305407f7d9b34e1e164ddd98\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=bd3dba9f435fa59f305407f7d9b34e1e164ddd98</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=86e39ce58e91fe55d4fdbc914cb1955c45acc20e\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=86e39ce58e91fe55d4fdbc914cb1955c45acc20e</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=282188ea84b9e0f9c4865f0609e7740f2f28e7b0\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=282188ea84b9e0f9c4865f0609e7740f2f28e7b0</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=968c0399159c65e24bb8b9969259e18791e1f4d8\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=968c0399159c65e24bb8b9969259e18791e1f4d8</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4a3a60d8caee49af6951a672c55b08436a8d1f86\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4a3a60d8caee49af6951a672c55b08436a8d1f86</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=40b76f1fb04af421c1415f7bcb168dfaa6960d0d\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=40b76f1fb04af421c1415f7bcb168dfaa6960d0d</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=117a538dbef62f8d39159dea652e633e01b50a9a\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=117a538dbef62f8d39159dea652e633e01b50a9a</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=a2986a7959919bc748784bb75970bfbd42697d3b\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=a2986a7959919bc748784bb75970bfbd42697d3b</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=6eca85d5c144ee8c899ee3cf8791f9087b15f2e8\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=6eca85d5c144ee8c899ee3cf8791f9087b15f2e8</a></li><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=ac63ddd70a5ccf5ebf790f06ea4cd4ed794c3978\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=ac63ddd70a5ccf5ebf790f06ea4cd4ed794c3978</a></li></ul><h4><span class=\"mw-headline\">bp-x86-fix-refcount-handling</span><span class=\"mw-editsection\"> </span></h4><p>Page reference counting error due to XSA-45/CVE-2013-1918 fixes. This is XSA-58.</p><ul style=\"margin-left: 1.6em;\"><li><a class=\"external free\" href=\"http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4552269c2bb3d34a3f3102f72c0edc82c70138ad\" rel=\"nofollow\">http://xenbits.xen.org/gitweb/?p=xen.git;a=commit;h=4552269c2bb3d34a3f3102f72c0edc82c70138ad</a></li></ul><h2><span class=\"mw-headline\">Bug fixes</span><span class=\"mw-editsection\"> </span></h2><h4><span class=\"mw-headline\">bf-libxenstore-static-race</span><span class=\"mw-editsection\"> </span></h4><p>When built statically, libxenstore does not use libpthread and therefor changes its mechanics to communicate with xenstored. Currently, xs_talkv expects any request made to xenstored to be processed and answered synchronously, while watch events could be queued in the fd for some time, putting xenstored's answer after them. read_reply would then fail with EINVAL, propagating the false error.</p><ul style=\"margin-left: 1.6em;\"><li>Not upstream yet</li></ul><h2><span class=\"mw-headline\">HVM support</span><span class=\"mw-editsection\"> </span></h2><h4><span class=\"mw-headline\">vgabios-edid-support</span><span class=\"mw-editsection\"> </span></h4><p>(int10, ax=0x15) get capabilities (bx=0), get EDID modes (bx=1).</p><ul style=\"margin-left: 1.6em;\"><li>vga-edid</li></ul><h4><span class=\"mw-headline\">vgabios-vbe-extension</span><span class=\"mw-editsection\"> </span></h4><p>Addition of VBE modes. Also align the stride for BytesPerScanLine.</p><ul style=\"margin-left: 1.6em;\"><li>vbe-new-res</li><li>vbe-add-odd-video-modes</li><li>vbe-stride-alignement-from-qemu</li><li>vbe-only-32bpp-and-16bpp</li></ul><h4><span class=\"mw-headline\">vgabios-spinlock-and-shadow</span><span class=\"mw-editsection\"> </span></h4><p>SpinlockWindows does not serialize the access to int 0x10 which forces us to use a spinlock to serialize it. To do that the 0x3800 IO Port is register in Qemu to serve as an atomic counter, in the spirit of what comes next.ShadowVGA BIOS uses the BDA to store values, but this area gets overwritten (IVT getting called and, after the kernel loads and switches to protected-mode, the memory there get re-used). This used to be shadowed by being put in the EBDA, which basically moved the problem (SMM still access EBDA when in protected mode and memory can get re-used). To still have those values accessible in the guest, there's a patch in qemu to register the IO Ports 0x3800-&gt;0x383f (EISA slot 3) to shadow them. So this patch adds the logic to actually shadow those value from the VGA BIOS. Rhe patch in Qemu is vbestate.</p><ul style=\"margin-left: 1.6em;\"><li>vga-spinlock-and-shadow.</li></ul><h4><span class=\"mw-headline\">vgabios-mod3-table</span><span class=\"mw-editsection\"> </span></h4><p>Initialize shadow port values for mode3 reset. The switch to vga text mode 3 is now done in the new xengfx driver without using int10 calls but rather configuring vga directly.</p><ul style=\"margin-left: 1.6em;\"><li>vga-mode3-table.</li></ul><h4><span class=\"mw-headline\">vgabios-vbe-xenvesa</span><span class=\"mw-editsection\"> </span></h4><p>Initialize shadow port values for XenVESA and EDID/mode list segments. Depends on vgabios-spinlock-and-shadow for the shadowing.</p><ul style=\"margin-left: 1.6em;\"><li>vbe-xenvesa-table (seems to be discuted around XC-3779)</li></ul><h4><span class=\"mw-headline\">vgabios-restrict-32b-modes</span><span class=\"mw-editsection\"> </span></h4><p>Check for 32bpp mode only flag in DISPI API before returning VBE information table.</p><ul style=\"margin-left: 1.6em;\"><li>vga-restrict-modes</li></ul><h4><span class=\"mw-headline\">hvmloader-smbios</span><span class=\"mw-editsection\"> </span></h4><p>Add SMBIOS headers and hvm_sminfo_table declaration, also deals with battery pass-through.</p><ul style=\"margin-left: 1.6em;\"><li>smbios</li><li>xen-smbios-table</li><li>smbios-battery-pt.</li></ul><h4><span class=\"mw-headline\">hvmloader-slic</span><span class=\"mw-editsection\"> </span></h4><p>Pass the SLIC to guests (Windows authentication?).</p><ul style=\"margin-left: 1.6em;\"><li>acpi-slic.</li></ul><h4><span class=\"mw-headline\">hvmloader-mtrr-changes</span><span class=\"mw-editsection\"> </span></h4><p>Change cache policy for 0xa000-0xbfff (remove WC flag).</p><ul style=\"margin-left: 1.6em;\"><li>mtrr-changes.</li></ul><h4><span class=\"mw-headline\">hvmloader-pxerom-optimize</span><span class=\"mw-editsection\"> </span></h4><p>Patch hvmloader to load the PXE ROM only when network boot flags is read from the CMOS.</p><ul style=\"margin-left: 1.6em;\"><li>hvmloader-only-load-pxerom-if-selected-in-bootorder.</li></ul><h4><span class=\"mw-headline\">hvmloader-overwrite-bios-copyrights</span><span class=\"mw-editsection\"> </span></h4><p>Read a value 'oem-installation-manufacturer' in xenstore and modify Seabios to overwrite the copyright string in the BIOS (support for WinXP OEM installations).</p><ul style=\"margin-left: 1.6em;\"><li>oem-install-bios-string.</li></ul><p> </p><h2><span class=\"mw-headline\">(General/Graphic) pass-through</span><span class=\"mw-editsection\"> </span></h2><h4><span class=\"mw-headline\">gpt-iommu-mapping</span><span class=\"mw-editsection\"> </span></h4><p>Add hypercalls for iommu mapping (iommu_map_batch, iommu_x_mapping).</p><ul style=\"margin-left: 1.6em;\"><li>iommu-extra-mappings.</li></ul><h4><span class=\"mw-headline\">gpt-vgabios-native</span><span class=\"mw-editsection\"> </span></h4><p>Load and pass to the guest the toolstack domain's VGA bios (read at 0xC000).</p><ul style=\"margin-left: 1.6em;\"><li>pt-load-vga-bios</li><li>init-vgabios-and-set-size</li><li>dummy-platform-vbios</li><li>video-memory-workaround</li><li>video-memory-workaround.</li></ul><h4><span class=\"mw-headline\">gpt-nvidia</span><span class=\"mw-editsection\"> </span></h4><p>Loads the standard vgabios if a nVidia is passed-through.</p><ul style=\"margin-left: 1.6em;\"><li>hvmload-nvidia-gpu</li></ul><h4><span class=\"mw-headline\">gpt-filter-igd-io</span><span class=\"mw-editsection\"> </span></h4><p>Convert IOs that setup the GTT to MMIOs for performances.</p><ul style=\"margin-left: 1.6em;\"><li>filter-igfx-io</li></ul><h4><span class=\"mw-headline\">gpt-igd-hp-resume-workaround</span><span class=\"mw-editsection\"> </span></h4><p>Save/restore BARs content during suspend/resume (Intel/HP broken firmware specific workaround, also we do that for every Intel Graphic Device)</p><ul style=\"margin-left: 1.6em;\"><li>hp-host-resume-workaround.</li></ul><h4><span class=\"mw-headline\">gpt-superblanker</span><span class=\"mw-editsection\"> </span></h4><p>Add the 0xfd000000 \"secret framebuffer\", from hvmloader in the e820, used to relocate the HDX guest framebuffer while switched away.</p><ul style=\"margin-left: 1.6em;\"><li>superblanker-fb.</li></ul><h4><span class=\"mw-headline\">gpt-cantiga-b3-errata</span><span class=\"mw-editsection\"> </span></h4><p>Implements Cantiga B3 VT-d Errata.</p><ul style=\"margin-left: 1.6em;\"><li>cantiga-b3-errata.</li></ul><h4><span class=\"mw-headline\">gpt-gpu-reset</span><span class=\"mw-editsection\"> </span></h4><p>Implement FLR, with specific quirks and SBR for external PCI(e) cards.</p><ul style=\"margin-left: 1.6em;\"><li>reset-gpu-when-reassigning-device-ownership</li><li>sandybridge-flr</li><li>gpu-reset-cleanup</li><li>nvidia-secondary-bus-reset</li><li>vtd-iotlb-domain-flush-on-reassign</li></ul><h2><span class=\"mw-headline\">ACPI emulation/pass-through</span><span class=\"mw-editsection\"> </span></h2><h3><span class=\"mw-headline\">Tools for ACPI</span><span class=\"mw-editsection\"> </span></h3><h4><span class=\"mw-headline\">acpi-acpica</span><span class=\"mw-editsection\"> </span></h4><p>Add acpica to the build system. Later ACPI patches require it to generate ACPI tables (dsdt, ssdt, ...)</p><ul style=\"margin-left: 1.6em;\"><li>power-management-enhancement (partial)</li></ul><h4><span class=\"mw-headline\">acpi-hvmloader-pm</span><span class=\"mw-editsection\"> </span></h4><p>Lid, power/sleep button, second battery definitions and Methods in DSDT.</p><ul style=\"margin-left: 1.6em;\"><li>power-management-enhancement (partial), hvmloader-set-acpi-shutdown-codes, acpi-reset-reg.</li></ul><h4><span class=\"mw-headline\">acpi-hvmloader-bcl-hack</span><span class=\"mw-editsection\"> </span></h4><p>Modify the DSDT in hvmloader to change information about brigthness control we're giving to the guest so it actually traps in qemu that THEN does the real brightness setting.</p><ul style=\"margin-left: 1.6em;\"><li>update-dsdt-bcl-count.</li></ul><h4><span class=\"mw-headline\">acpi-hvmloader-bcl</span><span class=\"mw-editsection\"> </span></h4><p>Expose backlight control methods in guest's DSDT.</p><ul style=\"margin-left: 1.6em;\"><li>inject-brightness-control-sci, guest-os-controlled-brightness-support.</li></ul><h4><span class=\"mw-headline\">acpi-hvmloader-tm</span><span class=\"mw-editsection\"> </span></h4><p>Expose thermal zones in guest's DSDT.</p><ul style=\"margin-left: 1.6em;\"><li>thermal-management (partial).</li></ul><h3><span class=\"mw-headline\">OEM specific features</span><span class=\"mw-editsection\"> </span></h3><h4><span class=\"mw-headline\">acpi-hvmloader-oem</span><span class=\"mw-editsection\"> </span></h4><p>OEM ACPI features.</p><ul style=\"margin-left: 1.6em;\"><li>oem-features, oem-features-version2.</li></ul><h4><span class=\"mw-headline\">acpi-xenpmd-oem</span><span class=\"mw-editsection\"> </span></h4><p>Add macro for /oem/event in xenstore.</p><ul style=\"margin-left: 1.6em;\"><li>oem-features, oem-features-version2.</li></ul><h4><span class=\"mw-headline\">acpi-applesmc</span><span class=\"mw-editsection\"> </span></h4><p>Add SMC ACPI in the ACPI DSDT for hvmloader.</p><ul style=\"margin-left: 1.6em;\"><li>applesmc-acpi</li></ul><h4><span class=\"mw-headline\">acpi-waet</span><span class=\"mw-editsection\"> </span></h4><p>Implement Windows ACPI Emulated Devices Table (WAET), with some info in it.</p><ul style=\"margin-left: 1.6em;\"><li>acpi-waet</li></ul><h3><span class=\"mw-headline\">Misc</span><span class=\"mw-editsection\"> </span></h3><h4><span class=\"mw-headline\">acpi-no-pci-hotplug</span><span class=\"mw-editsection\"> </span></h4><p>Remove pci hotplug from ACPI DSDT tables (_EJ0).</p><ul style=\"margin-left: 1.6em;\"><li>no-pci-hotplug.</li></ul><h4><span class=\"mw-headline\">acpi-power-button-and-s3</span><span class=\"mw-editsection\"> </span></h4><p>Set WAK_STS bit in acpi pm1a_sts register when resuming a domain (XC-5153).</p><ul style=\"margin-left: 1.6em;\"><li>set-acpi-status-regs-on-domain-resume.</li></ul><h2><span class=\"mw-headline\">XenClient specific</span><span class=\"mw-editsection\"> </span></h2><h4><span class=\"mw-headline\">xc-v4v</span><span class=\"mw-editsection\"> </span></h4><p>V4V, domain to domain communication protocol, through __HYPERVISOR_v4v_op hypercall (<a href=\"http://starchy.openxt.stuffs/wiki/index.php/V4v\" title=\"V4v\">V4V</a>, <a href=\"http://starchy.openxt.stuffs/wiki/index.php/V4v_hypervisor_api\" title=\"V4v hypervisor api\">V4V_Hypervisor_API</a>).</p><ul style=\"margin-left: 1.6em;\"><li>v4v-*.</li></ul><h4><span class=\"mw-headline\">xc-v4v-viptables</span><span class=\"mw-editsection\"> </span></h4><p>V4V implementation of viptables to filter traffic.</p><ul style=\"margin-left: 1.6em;\"><li>v4v_viptables</li></ul><h4><span class=\"mw-headline\">xc-ioreq-multiple</span><span class=\"mw-editsection\"> </span></h4><p>Ioreq server implementation. Trap hvm accesses to IO ports/MMIOs and send an event to a backend for processing.</p><ul style=\"margin-left: 1.6em;\"><li>hvm-ioreq-multiple.</li></ul><h4><span class=\"mw-headline\">xc-interrupt-debug-info</span><span class=\"mw-editsection\"> </span></h4><p>Dumps LAPICs and IOAPICs status of HVM domains in key-handle 'i' (\"dump interrupt bindings\").</p><ul style=\"margin-left: 1.6em;\"><li>fix-irq-debug-key, dump-lapic</li></ul><h4><span class=\"mw-headline\">xc-serial-card</span><span class=\"mw-editsection\"> </span></h4><p>Auto-configuration of PCI/PCMCIA serial card.</p><ul style=\"margin-left: 1.6em;\"><li>serial-card.</li></ul><h4><span class=\"mw-headline\">xc-cpuid</span><span class=\"mw-editsection\"> </span></h4><p>Make cpuid ours: Hide core/HT topology, make vcpu appear as multicores, leave FEATURE_MWAIT, put our signature.</p><ul style=\"margin-left: 1.6em;\"><li>revert-xen-3.4-18560</li><li>hvm-cpuid-multicore</li><li>addback-mwait-cstate</li><li>xci-cpuid-signature</li></ul><h4><span class=\"mw-headline\">xc-hvm-info</span><span class=\"mw-editsection\"> </span></h4><p>Primitive tool for our toolstack to report VTd/VTx handling.</p><ul style=\"margin-left: 1.6em;\"><li>tools-hvm-info.</li></ul><h4><span class=\"mw-headline\">xc-xenconsoled-syslog</span><span class=\"mw-editsection\"> </span></h4><p>An ugly way to make xenconsoled log into syslog.</p><ul style=\"margin-left: 1.6em;\"><li>xenconsoled-syslog</li><li>fix-xenconsoled-syslog.</li></ul><h4><span class=\"mw-headline\">xc-txt-shutdown-acpi-access-width</span><span class=\"mw-editsection\"> </span></h4><p>Fixes incorrect ACPI tables on some Dell platforms (980) that corrupt power operations with TXT enabled.</p><ul style=\"margin-left: 1.6em;\"><li>txt-shutdown-acpi-access-width.</li></ul><h4><span class=\"mw-headline\">xc-parse-video-from-mbi</span><span class=\"mw-editsection\"> </span></h4><p>Read the VBE from Multiboot information table given by the bootloader.</p><ul style=\"margin-left: 1.6em;\"><li>parse-video-from-mbi.</li></ul><h4><span class=\"mw-headline\">xc-isa-irq-guest-binding</span><span class=\"mw-editsection\"> </span></h4><p>Add ISA IRQ binding capability for guests.</p><ul style=\"margin-left: 1.6em;\"><li>isa-irq-guest-binding.</li></ul><h4><span class=\"mw-headline\">xc-elf64-header</span><span class=\"mw-editsection\"> </span></h4><p>Fix ELF64 headers in Xen and in the toolstack.</p><ul style=\"margin-left: 1.6em;\"><li>xen-elf64_header.</li></ul><h4><span class=\"mw-headline\">xc-disable-x2apic</span><span class=\"mw-editsection\"> </span></h4><p>Disable x2apic ...</p><ul style=\"margin-left: 1.6em;\"><li>disable-x2apic.</li></ul><h4><span class=\"mw-headline\">xc-shared-info</span><span class=\"mw-editsection\"> </span></h4><p>Add a way for XENMAPSPACE_shared_info hypercall to unmap the shared info page (used before going S4).</p><ul style=\"margin-left: 1.6em;\"><li>xenmapspace-unmap-shared-info</li></ul><h4><span class=\"mw-headline\">xc-ept-respect-cacheattr-pin</span><span class=\"mw-editsection\"> </span></h4><p>Ignore PAT memory type for cache-pinned pages.</p><ul style=\"margin-left: 1.6em;\"><li>ept-respect-cacheattr-pin</li></ul><h4><span class=\"mw-headline\">xc-get-time</span><span class=\"mw-editsection\"> </span></h4><p>Add HVMOP_get_time handler to xenctrl library.</p><ul style=\"margin-left: 1.6em;\"><li>add_hvmop_get_time_to_xc_tools.</li></ul><h4><span class=\"mw-headline\">xc-vtpm</span><span class=\"mw-editsection\"> </span></h4><p>VTPM support, hacks into the build system to build.</p><ul style=\"margin-left: 1.6em;\"><li>vtpm-support</li><li>vtpm-manager-patch</li><li>xen-hotplug-patch.</li></ul><h4><span class=\"mw-headline\">xc-tboot-shutdown-disable-irqs</span><span class=\"mw-editsection\"> </span></h4><p>tboot_shutdown is disabling interrupts a bit early.</p><ul style=\"margin-left: 1.6em;\"><li>tboot-shutdown-disable-irqs.</li></ul><h3><span class=\"mw-headline\">Hypercalls</span><span class=\"mw-editsection\"> </span></h3><h4><span class=\"mw-headline\">xc-set-servicevm</span><span class=\"mw-editsection\"> </span></h4><p>Add set_xcisrv hypercall for dom0 to declare a VM as service VM (restricted priviledges).</p><ul style=\"margin-left: 1.6em;\"><li>xci-domctl-set-servicevm.</li></ul><h4><span class=\"mw-headline\">xc-xen-translate</span><span class=\"mw-editsection\"> </span></h4><p>Implement translation of a list of gpfn to a list of mfn in new hypercalls: XENMEM_translate_gpfn_list &amp; XENMEM_release_mfn_list. Typically used to get framebuffer's mfns of the gpfns we receive from the graphic emulation (ioemu/xengfx).</p><ul style=\"margin-left: 1.6em;\"><li>xen_translate.</li></ul><h4><span class=\"mw-headline\">xc-foreign-batch-cacheattr</span><span class=\"mw-editsection\"> </span></h4><p>Implement xc_map_foreign_batch_cacheattr to map other guest's memory with given cache attribute. We use it to map guest vram with specific cache attributes.</p><ul style=\"margin-left: 1.6em;\"><li>uncached-foreign-mapping.</li></ul><h4><span class=\"mw-headline\">xc-memory-mapping-batch</span><span class=\"mw-editsection\"> </span></h4><p>Add an hypercall to map a list of gfns to a list of mfns, with IO permission (XEN_DOMCTL_memory_mapping, with specified list of mfns to map to and no assumption they are contiguous). Remove command use the gfns with the p2m to find the proper mfns.</p><ul style=\"margin-left: 1.6em;\"><li>XEN_DOMCTL_memory_mapping_batch.</li></ul><h4><span class=\"mw-headline\">xc-unpin-cacheattr</span><span class=\"mw-editsection\"> </span></h4><p>Add hypercall XEN_DOMCTL_unpin_cacheattr that removes a range with given attribute from the range list.</p><ul style=\"margin-left: 1.6em;\"><li>hvm-unset-mem-pinned-cachetattr, xc_domain_unpin_memory_cacheattr.</li></ul><h4><span class=\"mw-headline\">xc-aperture-map</span><span class=\"mw-editsection\"> </span></h4><p>Add an hypercall to map guest pages within an aperture in its own address space (modifying the p2m).</p><ul style=\"margin-left: 1.6em;\"><li>aperture-map-domctl.</li></ul><h3><span class=\"mw-headline\">That might be done otherwise or avoided</span><span class=\"mw-editsection\"> </span></h3><h4><span class=\"mw-headline\">relax-pv-l1e-cache-check</span><span class=\"mw-editsection\"> </span></h4><p>Relax l1e cache checking for pv guests.</p><ul style=\"margin-left: 1.6em;\"><li>hvm_get_mem_pinned_cacheattr_always.</li></ul><h4><span class=\"mw-headline\">xc-vcpu-get-time</span><span class=\"mw-editsection\"> </span></h4><p>Add VCPUOP_get_time to make NOW() macro available in PV guests.</p><ul style=\"margin-left: 1.6em;\"><li>vcpu_op_hcall_get_time.</li></ul><p><em>Could be calculated from inside the guest using pv timers</em></p><h4><span class=\"mw-headline\">xc-iommu-flush-on-unmap</span><span class=\"mw-editsection\"> </span></h4><p>Add an IOMMU global context flush at the end of the device assignation to a domain.</p><ul style=\"margin-left: 1.6em;\"><li>iommu-add-flush-on-unmap</li></ul><p><em>Not sure why this is necessary</em></p><h4><span class=\"mw-headline\">xc-evtchn-no-pending-when-s3</span><span class=\"mw-editsection\"> </span></h4><p>Avoid setting the flag for pending event-channel if the guest is in s3.</p><ul style=\"margin-left: 1.6em;\"><li>evtchn-do-not-set-pending-if-s3.</li></ul><h4><span class=\"mw-headline\">xc-shadow-op-blow-tables</span><span class=\"mw-editsection\"> </span></h4><p>Add an hypercall to blow shadow tables of a domain (unpining them before if necessary).</p><ul style=\"margin-left: 1.6em;\"><li>shadow-op-blow-tables</li><li>xc_shadow_blow_tables.</li></ul><h4><span class=\"mw-headline\">xc-keep-bus-mastering-after-iommu-fault</span><span class=\"mw-editsection\"> </span></h4><p>Do not disable Bus Mastering after an IOMMU fault, which is the case upstream (we have some when switching out of a PVM).</p><ul style=\"margin-left: 1.6em;\"><li>keep-bus-mastering-after-iommu-fault</li></ul><p><em>Would be better not to fault in the first place.</em></p>",
    "date": "2024-11-15",
    "disclaimer": "Users of this benchmark dataset are advised to check Atlassian’s official documentation for the most current information.",
    "space": "~rphilipson"
}