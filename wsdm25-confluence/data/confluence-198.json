{
    "id": "confluence-198",
    "title": "XCPMD Testing",
    "url": "https://openxt.atlassian.net/wiki/spaces/TEST/pages/15368266/XCPMD+Testing",
    "content": "<p>Owned by Jennifer Temkin\nLast updated: Nov 30, 2015 by Jennifer Temkin\n\n</p><h2><span class=\"confluence-link\">Basic functionality test</span></h2><p><span style=\"line-height: 1.4285715;\">Check loaded conditions</span></p><p style=\"margin-left: 30.0px;\"><code>    dbus-send --system --print-reply --dest=com.citrix.xenclient.xcpmd / com.citrix.xenclient.xcpmd.get_conditions</code><br/> Running the above command should return a list of 36 conditions (as of this writing).</p><p>Check loaded actions</p><p style=\"margin-left: 30.0px;\"><code>dbus-send --system --print-reply --dest=com.citrix.xenclient.xcpmd / com.citrix.xenclient.xcpmd.get_actions</code><br/> Running the above command should return a list of 32 actions (as of this writing).</p><p>Add a variable</p><p style=\"margin-left: 30.0px;\"><code>dbus-send --system --print-reply --dest=com.citrix.xenclient.xcpmd / com.citrix.xenclient.xcpmd.add_var string:'test_var1' string:'\"test rule 1: on battery!\"'</code><br/>Running '<code>db-ls /power-management</code>' should show a vars node with test_var1:\"test rule 1: on battery!\"</p><p>Add a rule</p><p style=\"margin-left: 30.0px;\"><code>dbus-send --system --print-reply --dest=com.citrix.xenclient.xcpmd / com.citrix.xenclient.xcpmd.add_rule string:'test_rule1' string:'whileUsingBatt()' string:'logString($test_var1)' string:'logString(\"test rule 1: on AC!\")'</code><br/>Running '<code>db-ls /power-management</code>' should show a rules node with test_rule1 and its properties.<br/>Unplugging the laptop should cause 'test rule 1: on battery!' to print in /var/log/messages.<br/>Plugging it back in should cause 'test rule 1: on AC!' to print in /var/log/messages.</p><p><span style=\"line-height: 1.4285715;\">Try to remove a variable that is in use</span></p><p style=\"margin-left: 30.0px;\"><code>    dbus-send --system --print-reply --dest=com.citrix.xenclient.xcpmd / com.citrix.xenclient.xcpmd.remove_var string:'test_var1'</code><br/> An error message should be received, saying the variable is still in use.<br/><span style=\"line-height: 1.4285715;\">Running '</span><code style=\"line-height: 1.4285715;\">db-ls /power-management</code><span style=\"line-height: 1.4285715;\">' should still show test_var1 under the vars node.</span></p><p><span style=\"line-height: 1.4285715;\">Remove a rule</span></p><p style=\"margin-left: 30.0px;\"><code>    dbus-send --system --print-reply --dest=com.citrix.xenclient.xcpmd / com.citrix.xenclient.xcpmd.remove_rule string:test_rule1</code><br/>Running '<code>db-ls /power-management</code>' should show an empty rules node<br/> Unplugging the laptop should not cause 'test rule 1: on battery!' to print<br/> Plugging it back in should not cause 'test rule 1: on AC!' to print</p><p>Remove a variable</p><p style=\"margin-left: 30.0px;\"><code>dbus-send --system --print-reply --dest=com.citrix.xenclient.xcpmd / com.citrix.xenclient.xcpmd.remove_var string:'test_var1'</code><br/> Running '<code>db-ls /power-management</code>' should show an empty vars node</p><p>Load rules from a file (<span><ac:link><ri:attachment ri:filename=\"test_rules.rules\"></ri:attachment></ac:link>)</span></p><p style=\"margin-left: 30.0px;\">Copy the accompanying rules file to /root/xcpmd.rules <br/> <code>dbus-send --system --print-reply --dest=com.citrix.xenclient.xcpmd / com.citrix.xenclient.xcpmd.load_policy_from_file string:'/root/xcpmd.rules'</code><br/> Running '<code>db-ls /power-management</code>' should show several rules loaded under the rules node<br/> If this fails due to SELinux, temporarily disable it with 'setenforce 0', rerun the dbus-send command, and reenable with 'setenforce 1'.<br/> The rules in it are used for subsequent tests.</p><p>Test VM events</p><p style=\"margin-left: 30.0px;\">Pause any vm with '<code>xec-vm -n &lt;vmname&gt; pause</code>'.<br/> This should cause the message 'test rule 2: vm paused!' to print in /var/log/messages<br/> Unpause the vm you paused with '<code>xec-vm -n &lt;vmname&gt; unpause</code>'.<br/> This should cause the message 'test rule 2: vm unpaused!' to print in /var/log/messages</p><p>Test VM actions</p><p style=\"margin-left: 30.0px;\">Unplugging the laptop should cause the UIVM to pause.<br/> This can be tested either by SSH-ing in and running xec-vm, or simply by seeing if the system responds to mouse movements.<br/> Plugging the laptop back in should cause the UIVM to unpause and become responsive to mouse and keyboard commands.</p><p>Clear policy</p><p style=\"margin-left: 30.0px;\"><code>dbus-send --system --print-reply --dest=com.citrix.xenclient.xcpmd / com.citrix.xenclient.xcpmd.clear_policy</code><br/> Unplugging the laptop should no longer pause the UIVM.<br/> Pausing any VM should no longer cause the message 'test rule 2: vm paused!' to print in /var/log/messages<br/> Running '<code>db-ls /power-management</code>' should show empty rules and vars nodes.</p><p>Load default policy</p><p style=\"margin-left: 30.0px;\">Load the default policy by restarting XCPMD with no rules or variables in the DB.<br/>Running '<code>db-ls /power-management</code>' should show three variables and five rules.</p><p>Check default policy</p><p style=\"margin-left: 30.0px;\">Close the laptop lid. The screen should turn off.<br/>Open the laptop lid. The screen should turn on. (It may flicker a few times.)<br/>Unplug the laptop. The screen should dim to 75%.<br/>Plug the laptop back in. The screen should brighten to 100%.<br/>Press the brightness down key several times. Each time, the screen should dim slightly.<br/>Press the brightness up key several times. Each time, the screen should brighten slightly.<br/>Unplug the laptop and wait for the aggregate battery capacity of the system to drop below 10%. The screen should dim to 60%.<br/>Plug the laptop back in. The screen should brighten to 100%.</p>",
    "date": "2024-11-15",
    "disclaimer": "Users of this benchmark dataset are advised to check Atlassian’s official documentation for the most current information.",
    "space": "TEST"
}