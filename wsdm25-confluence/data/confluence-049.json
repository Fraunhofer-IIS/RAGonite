{
    "id": "confluence-049",
    "title": "XT xen patch-queue port to 4.3.x",
    "url": "https://openxt.atlassian.net/wiki/spaces/~rphilipson/pages/34799624/XT+xen+patch-queue+port+to+4.3.x",
    "content": "<p>Owned by Ross Philipson\nLast updated: Apr 27, 2016 by Ross Philipson\n\n</p><p><span class=\"mw-headline\"><ac:structured-macro ac:macro-id=\"6ec148fd-25a5-472b-9e03-3cb811f70a2e\" ac:name=\"toc\" ac:schema-version=\"1\"></ac:structured-macro><br/></span></p><h2><span class=\"mw-headline\">To Do not in existing patches</span><span class=\"mw-editsection\"> </span></h2><ul style=\"margin-left: 1.6em;\"><li>Relative symlinks created in XC-E Makefile patches need to be mitigated</li></ul><h2><span class=\"mw-headline\">To Verify Upstream</span><span class=\"mw-editsection\"> </span></h2><ul style=\"margin-left: 1.6em;\"><li>bp-recover-from-faults-on-xrstor</li><li>bp-properly-check-guest-input-to-xsetbv</li><li>xc-elf64-header</li></ul><h2><span class=\"mw-headline\">To Verify if Still Needed</span><span class=\"mw-editsection\"> </span></h2><ul style=\"margin-left: 1.6em;\"><li>xc-relax-pv-l1e-cache-check</li><li>xc-iommu-flush-on-unmap</li><li>xc-evtchn-no-pending-when-s3<ul style=\"margin-left: 1.6em;\"><li>tomaszw: I'm pretty sure it's still needed, the evtchn pending code looks to have same problem as it did - the only thing that changes is that this function does not have return value anyway, but what we care here for is that the pending flag needs to not be set because it guards access to vcpu_mark_events_pending() which will not be reexectued if its already set</li></ul></li></ul><h2><span class=\"mw-headline\">To Port</span><span class=\"mw-editsection\"> </span></h2><h2><span class=\"mw-headline\">To Discuss</span><span class=\"mw-editsection\"> </span></h2><ul style=\"margin-left: 1.6em;\"><li>xc-unpin-cacheattr<ul style=\"margin-left: 1.6em;\"><li>tomaszw: not sure if this is used at all in XT, doubt it, need check</li></ul></li></ul><ul style=\"margin-left: 1.6em;\"><li>xc-disable-x2apic<ul style=\"margin-left: 1.6em;\"><li>XCE used to do this as well, and we no longer need to with new Xen</li><li>tomaszw: we only were disabling it in XT since s3 code was broken in x2apic mode, I think its fixed for some time so we do not need it</li></ul></li><li>xc-vtpm<ul style=\"margin-left: 1.6em;\"><li>Changes the tools makefile to apply patches; consider moving vtpm out of tree</li></ul></li><li>xc-memory-mapping-batch<ul style=\"margin-left: 1.6em;\"><li>Robert's version of this functionality is already in XCE, and partly through upstreaming (already upstream?)</li><li>Requires integration work in XT</li></ul></li><li>hvmloader-pxerom-optimize<ul style=\"margin-left: 1.6em;\"><li>Shouldn't be done this way anymore with QEMU 1.2+ and Seabios</li><li>Omit ROM BAR initialization for e1000 in QEMU when network boot isn't enabled</li><li>tomaszw: not really necessary at all anymore IMO after seabios was changed recently to be more strict WRT selected boot devices</li></ul></li><li>gpt-gpu-reset<ul style=\"margin-left: 1.6em;\"><li>Ross says this should be done differently going forward</li></ul></li><li>acpi-acpica<ul style=\"margin-left: 1.6em;\"><li>No idea what this is for - is it because the XT build distribution doesn't include a sufficiently modern iasl?</li><li>tomaszw: appears to be unneeded</li></ul></li></ul><h2><span class=\"mw-headline\">Complete</span><span class=\"mw-editsection\"> </span></h2><ul style=\"margin-left: 1.6em;\"><li>xc-get-time</li><li>xc-hvm-info</li><li>xc-xenconsoled-syslog</li><li>xc-ept-respect-cacheattr-pin</li><li>xc-interrupt-debug-info</li><li>xc-shadow-op-blow-tables</li><li>xc-vcpu-get-time<ul style=\"margin-left: 1.6em;\"><li>Looks like upstream has an alternate way to do this now... Investigate removal.</li></ul></li><li>xc-tboot-shutdown-disable-irqs</li><li>xc-txt-shutdown-acpi-access-width</li><li>xc-parse-video-from-mbi<ul style=\"margin-left: 1.6em;\"><li>Breaks XC-E boot</li></ul></li><li>xc-cpuid<ul style=\"margin-left: 1.6em;\"><li>Light integration work required on XCE</li></ul></li><li>xc-isa-irq-guest-binding</li><li>xc-shared-info</li><li>xc-set-servicevm<ul style=\"margin-left: 1.6em;\"><li>Needs review after port</li><li>Port complicated by upstream. Access checks now done with XSM hooks</li></ul></li><li>xc-aperture-map<ul style=\"margin-left: 1.6em;\"><li>Converted gfn_to_mfn to get_page_from_gfn() and page_to_mfn(). Needs validation</li></ul></li><li>xc-xen-translate<ul style=\"margin-left: 1.6em;\"><li>Added XSM support. Need to validate permissions</li><li>gmfn_to_mfn converted to mfn_x. Needs validation<ul style=\"margin-left: 1.6em;\"><li>tomaszw: was bugging due to locking p2m entries forever, converted it to use unlocked version of the func</li></ul></li></ul></li><li>gpt-iommu-mapping<ul style=\"margin-left: 1.6em;\"><li>Removed iommu_flush_iotlb - Functionality provided upstream by new iommu_iotlb_flush</li><li>Converted gfn_to_mfn to get_page_from_gfn() and page_to_mfn().</li></ul></li><li>vgabios-spinlock-and-shadow</li><li>acpi-applesmc</li><li>xc-ioreq-multiple<ul style=\"margin-left: 1.6em;\"><li>Altered to work with unmodified device models using the original API. Needs testing</li><li>tomaszw: tested and made some fixes, seems to work</li></ul></li><li>xc-v4v*<ul style=\"margin-left: 1.6em;\"><li>We can switch to Ross' version that was submitted upstream, but the interfaces are different and would require guest driver changes.</li><li>tomaszw: I ported the old version for now since can't do any meaningful testing w/o v4v as network/ui vms depend on it. Happy to switch to Ross's version later</li></ul></li><li>xc-foreign-batch-cacheattr<ul style=\"margin-left: 1.6em;\"><li>tomaszw: ported xc-foreign-batch-cacheattr as it's currently needed - don't think its redudant with xc_domain_pin_memory_cacheattr at least as that call operates on hvms only, which is not how the xc-foreign-batch-cacheattr is used in XT atm</li></ul></li></ul><h2><span class=\"mw-headline\">Possibly Excluded From Common Xen</span><span class=\"mw-editsection\"> </span></h2><p>Changes to hvmloader/ACPI and the VGA BIOS in XT and XCE are incompatible. Thus it is proposed that hvmloader and the VGA BIOS live outside the common platform until the display architecture is pulled in. We will also need to decide if we intend to reconcile the differences between how XT and XCE handle S-states and the backlight (XT backlight passthrough already dropped from Common Linux - see Ross).</p><ul style=\"margin-left: 1.6em;\"><li>acpi-* (acpi-waet already upstream)</li><li>hvmloader-mtrr-changes</li><li>hvmloader-overwrite-bios-copyrights (Equivalent patch in XCE already - adapt XT to that method?)</li><li>hvmloader-slic (Equivalent patch in XCE - QEMU portion of XCE version is accepted upstream)<ul style=\"margin-left: 1.6em;\"><li>tomaszw: since in XT qemu is running in stubdom, basing this on qemu is problematic, hvmloader seems a cleaner solution (or multiple qemus?)</li></ul></li><li>vgabios-edid-support (Equivalent patch in XCE already - adapt XT to that method?)</li><li>vgabios-restrict-32b-modes (Equivalent patch in XCE already)</li><li>vgabios-vbe-extension</li><li>vgabios-vbe-xenvesa</li><li>vgabios-mod3-table</li><li>gpt-nvidia</li><li>gpt-superblanker</li><li>gpt-vgabios-native</li><li>gpt-filter-igd-io<ul style=\"margin-left: 1.6em;\"><li>tomaszw: it looks like version of this is already upstream which uses mem mapping instead of copying (in drivers/passthrough/vtd/quirks.c) - needs verification</li></ul></li><li>gpt-igd-hp-resume-workaround</li><li>gpt-cantiga-b3-errata<ul style=\"margin-left: 1.6em;\"><li>this looks to be already upstream</li></ul></li><li>tomaszw: not surewhy would we want to exclude all gpt patches these from common xen? They should have no side effects w/o presence of gpu passthrough anyway.</li></ul><h2><span class=\"mw-headline\">Confirmed Already Included from XCE</span><span class=\"mw-editsection\"> </span></h2><ul style=\"margin-left: 1.6em;\"><li>xc-serial-card<ul style=\"margin-left: 1.6em;\"><li>Boot command line options changed - Requires integration work</li></ul></li><li>hvmloader-smbios (Cherry-picked from XT)</li></ul><h2><span class=\"mw-headline\">Confirmed Already Included Upstream</span><span class=\"mw-editsection\"> </span></h2><ul style=\"margin-left: 1.6em;\"><li>bp-intel-opregion</li><li>acpi-nvs-opregion</li><li>hvmloader-intel-opregion</li><li>bp-seabios-support</li><li>bp-xenstore-path-is-subpath</li><li>xenstore-add-xs-path-is-subpath</li><li>xenstore-fix-unwatch</li><li>bp-legacy-bridges-int-remap-validation</li><li>bp-fix-sysenter-vulnerability</li><li>bp-fix-irq-access-permission</li><li>bp-defer-evtchn-pointer-store</li><li>bp-*-preemptible</li><li>bp-dont-permit-svt-no-verify</li><li>bp-fix-rcu-domain-locking</li><li>bp-fix-information-leak-on-amd-cpus</li><li>xc-keep-bus-mastering-after-iommu-fault</li></ul>",
    "date": "2024-11-15",
    "disclaimer": "Users of this benchmark dataset are advised to check Atlassian’s official documentation for the most current information.",
    "space": "~rphilipson"
}