{
    "id": "confluence-005",
    "title": "Getting Things Done",
    "url": "https://openxt.atlassian.net/wiki/spaces/DC/pages/14844073/Getting+Things+Done",
    "content": "<p>Owned by Ross Philipson\nLast updated: Mar 24, 2017 by Ross Philipson\n\n</p><ac:structured-macro ac:macro-id=\"8b686237-640b-4a99-aad7-c28571c6b798\" ac:name=\"info\" ac:schema-version=\"1\"><ac:parameter ac:name=\"icon\">None</ac:parameter><ac:rich-text-body><p><ac:image ac:width=\"80\"><ri:attachment ri:filename=\"cc-by.png\" ri:version-at-save=\"1\"></ri:attachment></ac:image></p><p>Copyright 2013 by Citrix Systems, Inc. This work is licensed under the Creative Commons Attribution 4.0 International License. To view a copy of this license, visit <a class=\"external-link\" href=\"http://creativecommons.org/licenses/by/4.0/\" rel=\"nofollow\">http://creativecommons.org/licenses/by/4.0/</a>.</p></ac:rich-text-body></ac:structured-macro><p><strong><br/></strong></p><p><strong>TODO:</strong> Currently this page is under the notes section since that is what it is - a collection of notes from Rob Moran. A lot of this information would be really useful in a page under <ac:link><ri:page ri:content-title=\"Getting Started\" ri:space-key=\"OD\" ri:version-at-save=\"22\"></ri:page></ac:link> but it would need to be cleaned up and organized. It is still quite useful for non-beginners though.</p><p><ac:structured-macro ac:macro-id=\"fca9ada8-9aae-4089-8ff8-71b7888a58ea\" ac:name=\"toc\" ac:schema-version=\"1\"></ac:structured-macro></p><h2><span>Overview</span></h2><p>This page is a bunch of salvaged notes from a former XenClient engineer. There are quite a few useful tips and instructions for just doing things on (Open)XT. It is being splatted here in its original form for now - if folks want to clean it up, re-organize it and add to it, please feel free.</p><h2><span>Z Indices</span></h2><h3><span>Ideal</span></h3><ul><li>apply update 6000</li><li>mouse pointer 5000</li><li>native screen 4500</li><li>wait screen 4000</li><li>menu popup 3000</li><li>tooltips 2000</li><li>dialogs 950</li><li>header 300</li><li>menu bar 200</li><li>footer 100</li><li>content areas 1,0,-1</li></ul><h3><span>Current (hacky for X applets)</span></h3><ul><li>mouse ponter 5000</li><li>menu popup 3000</li><li>tooltips 2000</li><li>header 1800</li><li>menu bar 1700</li><li>footer 1600</li><li>wait screen 1500</li><li>dialogs 950</li><li>content area 0</li></ul><h2><span>Synchronizer XT</span></h2><p>You can test this by logging on to root@autotest-1</p><p><code>$ experiments -m ludo --syncxt-test</code></p><p>if you need to reset the db on your machine (check the help to see if this is correct)</p><p><code>$ experiments -m ludo --wipe-database</code></p><h2><span>Extending xenclient/root disc size</span></h2><p>First, delete something (/usr/lib/xui/images is good) to make room to do the resize. Alternatively steal from somewhere else e.g.</p><pre>$ lvreduce -L -1G xenclient/storage\n</pre><pre>$ lvextend -L +1G xenclient/root\n$ resize2fs -p /dev/xenclient/root</pre><h2><span>Debugging a daemon</span></h2><p>Example using input daemon - you will probably need to extend xenclient/root first, as shown above.</p><pre>$ opkg update\n$ opkg install gdb //installs the debugger program\n$ opkg list //lists available packages - find the one you're looking for\n$ opkg install xenclient-input-daemon-dbg //we had to run this twice to get it to success\n</pre><pre>$ /etc/init.d/xenclient-input restart\n</pre><pre>$ ps auxw | grep input //to find the pid\n</pre><pre>$ gdb /usr/bin/input_server [pid]\n</pre><p>some gdb basics</p><pre>$ c // to continue\n$ where // to get a stack trace\n$ q // to quit</pre><h2><span>Getting Things Done</span></h2><h3><span>Enabling ‘Secure Launch’</span></h3><p><span><strong>NOTE:</strong> the tpm-setup script is currently broken.<br/></span></p><p>(This was on my HP 8470p so might vary a little bit)</p><ul><li>Enter BIOS setup</li><li>Go to Security settings</li><li>Set BIOS password to <em>!XenR00t</em> (they are zeros)</li><li>In the security settings - clear security keys (If the option is there)</li><li>go to <strong>TPM Embedded Security</strong></li><li>Enable <strong>Embedded Security Device State</strong></li><li>Save and reboot</li><li>Enter BIOS setup again</li><li>Go to Device Config and set <strong>TXT On</strong></li><li>Save and reboot into XC</li><li>Open the XC terminal</li><li>Type:</li></ul><pre>$ nr\n$ tpm–setup\n</pre><ul><li>Set the password to <em>xenroot</em></li><li>It will do it’s thing… then you need to reboot twice.</li><li>Job done.</li></ul><h3><span>Allowing a CD install of XC to upgrade OTA</span></h3><pre> vi /config/repo-cert.conf to read:\n ALLOW_DEV_REPO_CERT='true'</pre><h3><span>Filling a drive</span></h3><p>10GB:</p><pre>$ dd if=/dev/zero of=/storage/temp bs=1M count=$((10*1000))</pre><h3><span>Turning on touch-screen keyboard in UIVM</span></h3><pre> on the device, edit /usr/lib/xui/script/constants.js and set KEYBOARD: true, around line 360</pre><h3><span>Running webkit JavaScript from GTK</span></h3><pre> webkit_web_view_execute_script(web_view, \"alert(window.XUICache.Host.publish_topic);\");</pre><h3><span>Checking out source</span></h3><p>git pull in these directories:</p><pre> build/oe/repos/extra/\n build/oe/xenclient/</pre><h3><span>Unlocking XT installs (for SSH and v4v-proxy)</span></h3><pre>$ newrole -r sysadm_r\n$ setenforce 0\n$ sed -i \"s/enforcing/permissive/\" /etc/selinux/config</pre><h3><span>Mounting VM read-write</span></h3><p>This works for UIVM</p><pre>$ db-write \"/xenmgr/bypass-sha1sum-checks\" true\n$ xec-vm -n &lt;name&gt; --disk 0 set mode w\n</pre><p>If already running:</p><pre>$ xec-vm -n &lt;name&gt; reboot\n</pre><p>Inside VM:</p><pre>$ mount -o remount,rw /</pre><h3><span>Passing Through PCI Devices</span></h3><p>put the below into: /etc/modprobe.d/blacklist-sound.conf</p><pre> blacklist snd_hda_codec_intelhtml\n blacklist snd_hda_codec_idt\n blacklist snd_hda_intel\n blacklist snd_hda_codec\n blacklist snd_hwdep\n blacklist snd_pcm\n blacklist pcspkr\n blacklist snd_timer\n blacklist snd\n blacklist soundcore\n blacklist snd_page_alloc\n</pre><p>reboot the host change the VM config to passthrough the device:</p><pre>$ xec-vm -u&lt;vm uuid&gt;  add-pt-rule 0x0403 any any\n</pre><p>OR</p><pre>$ xec-vm -n&lt;vmname&gt;  add-pt-rule 0x0403 any any\n</pre><p>and start your VM.</p><p>For reference: 0x0403 is the PCI class for an audio device. You can see this from looking at the output in dom0 of lspci -vvv to find the PCI bus address of the device and then lspci -vvvn to see the device class of it.</p><h3><span>Startup Wizard</span></h3><pre>$ touch /config/deferred_dom0_password\n$ touch /config/deferred_kb_layout\n$ touch /config/deferred_eula\n$ touch /config/deferred_language</pre><h3><span>xenmgr Ops</span></h3><pre>$ tail -f /var/log/xenmgr.log</pre><h4><span>Using xec</span></h4><p>You can work out a lot of this from looking at the IDL<a href=\"http://git.uk.xensource.com/cgit.cgi/xenclient/idl.git/tree/interfaces\">http://git.uk.xensource.com/cgit.cgi/xenclient/idl.git/tree/interfaces</a> lists all of the properties and methods on <a class=\"internal absent\" href=\"https://github.com/OpenXT/openxt/wiki/xenmgr\" style=\"line-height: 1.42857;\">xenmgr</a> object. \"-o /\" specifies the object, and if not supplied is assumed to be \"/\".</p><pre>$ xec\n$ xec -o /\n</pre><p>calls one of the methods listed</p><pre>$ xec list-vms\n</pre><p>lists all of the properties and methods on the host object.</p><pre>$ xec -o /host\n</pre><p>this will Get one of the properties listed</p><pre>$ xec -o /host Get build-info\n</pre><p>to interrogate vms</p><pre>$ xec-vm\n</pre><p>these are equivalent and will show you properties and methods available on VMs</p><pre>$ xec-vm -o /vm/[uuid]\n$ xec -o /vm/[uuid]\n</pre><p>if you're getting a property that exists in more than one of the interfaces, then you need to explicitly set the interface</p><pre>$ xec-vm -o /vm/[uuid] -i com.citrix.xenclient.xenmgr.vm.unrestricted Get state\n</pre><p>to get VM by name</p><pre>$ xec-vm -n \"VM Name\"</pre><h4><span>Turning on CTRL+0 tip</span></h4><pre>$ xec set show-msg-on-vm-start true</pre><h4><span>Making Status Report appear</span></h4><pre>$ xec status-report-screen true</pre><h4><span>Poking VM properties</span></h4><pre>$ xec-vm -n \"Windows XP\" set-db-key policies.wired-networking true</pre><h3><span>Writing XenStore</span></h3><pre>$ xenstore-write /local/domain/1/report/state 1</pre><h3><span>dbus-send examples</span></h3><h4><span>notifications:</span></h4><pre>$ dbus-send --system --type=signal /host com.citrix.xenclient.xenmgr.host.storage_space_low int32:5 \n$ dbus-send --system --type=signal / com.citrix.xenclient.updatemgr.update_state_change string:\"downloaded-files\"\n$ dbus-send --system --type=signal / com.citrix.xenclient.usbdaemon.device_rejected string:\"device\" string:\"reason\"\n$ dbus-send --system --type=signal / com.citrix.xenclient.xenmgr.guestreq.requested_attention string:&lt;UUID&gt; objpath:&lt;PATH&gt;</pre><h4><span>generic notifications:</span></h4><pre>$ dbus-send --system --type=signal / com.citrix.xenclient.xenmgr.host.generic_message string:\"Information\" string:\"Here is some important information\"\n$ dbus-send --system --type=signal / com.citrix.xenclient.xenmgr.host.generic_message string:\"Information\" string:\"I will only appear for 5 seconds\" int32:5000\n$ dbus-send --system --type=signal / com.citrix.xenclient.xenmgr.host.generic_message string:\"Warning\" string:\"I am a warning\" int32:5000 int16:1\n$ dbus-send --system --type=signal / com.citrix.xenclient.xenmgr.host.generic_message string:\"Error\" string:\"I am an error and have a known ID\" int32:5000 int16:2 string:\"myid2\"\n$ dbus-send --system --type=signal / com.citrix.xenclient.xenmgr.host.generic_message string:\"Information\" string:\"The percentage I am showing is:\" int32:5000 int16:0 string:\"myid2\" int16:69</pre><h4><span>signals:</span></h4><pre>$ dbus-send --system --type=signal / com.citrix.xenclient.xui.popup_network_menu uint32:1000 uint32:72\n$ dbus-send --system --type=signal / com.citrix.xenclient.bed.notify.vm.vm_updated_reboot_required string:\"&lt;UUID&gt;\"\n$ dbus-send --system --type=signal / com.citrix.xenclient.bed.notify.vm.vm_updated_clean_reboot_required string:\"&lt;UUID&gt;\"\n$ dbus-send --system --type=signal / com.citrix.xenclient.bed.notify.vm.vm_lease_near_expiry string:\"&lt;UUID&gt;\" int16:1000\n$ dbus-send --system --type=signal /com/citrix/xenclient/xenmgr/host com.citrix.xenclient.bed.notify.server.auth_required</pre><h4><span>method:</span></h4><pre>$ dbus-send --system --type=method_call --print-reply --dest=com.citrix.xenclient.xenmgr /com/citrix/xenclient/xenmgr/host com.citrix.xenclient.xenmgr.host.status</pre><h3><span>Poking the database</span></h3><pre>$ db-ls\n$ db-ls -f\n$ db-ls /xenmgr\n$ db-rm /xenmgr/showMsgOnVmStart</pre><h3><span>gettimeofday trickery</span></h3><pre>$ ps ax (find midori process)\n$ strace -p &lt;pid&gt;\n$ (strace -p &lt;pid&gt; 2&gt;&amp;1 | grep gettimeofday &gt; file) &amp; sleep 10; kill %1\n$ wc -l file\n</pre><p>This was to see how often the javascript was polling for gettimeofday, since it affects power.</p><h3><span>Debugging UID</span></h3><pre>$ killall uid\n$ LD_PRELOAD=/usr/lib/libv4v-1.0.so.0.0.0 INET_IS_V4V=1 uid --no-daemonize &gt; /tmp/uid.log</pre><h3><span>Net Boot</span></h3><p>Boot a laptop from network, and either pick one of the options as described, or type in the name of a build that's not mentionned (e.g. cam-oeprod-123456-master)</p><p>The old school method is below:</p><pre>$ ssh user@boiler\n (NIS password)\n$ cd /home/xc_tftpboot/pxe/grover\n$ ln -sf ../builds/master/cam-prod-008284-master/netboot/pxelinux.cfg\n</pre><p>then boot laptop from network</p><h3><span>GIT</span></h3><p>You MUST set these in the global config</p><pre>$ git config --global user.name 'Joe Bloggs'\n$ git config --global user.email 'Joe.Bloggs@citrix.com'\n</pre><p>Optionally, the following will set up any branches you checkout/create in the future with the rebase property set to true, which is useful as this means when you pull, it is the same as running 'git pull --rebase':</p><pre>$ git config --global branch.autosetuprebase always\n</pre><p>To view the global config</p><pre>$ git config --global -l\n</pre><p>To view the local config (i.e. if you're in the directory of a git project it will show you specific config for that)</p><pre>$ git config --local -l\n</pre><pre>$ git branch //show branches\n$ git branch &lt;name&gt; //create branch called &lt;name&gt;\n$ git checkout &lt;name&gt; //switch to branch called &lt;name&gt;\n</pre><pre>$ git reset --hard &lt;hash&gt; //reset tree to the &lt;hash&gt; of the commit\n$ git checkout &lt;filename&gt; //reset &lt;filename&gt; to origin\n</pre><pre>$ git stash //like diff stack\n :switch branch\n$ git stash apply //apply the diff stack on the branch you've switched to\n</pre><pre>$ git clone &lt;fromtree&gt; &lt;totree&gt;\n</pre><pre>$ git push &lt;server&gt; &lt;branchfrom&gt;:&lt;branchto&gt; //creates a remote branch based on your local branch\n$ git push &lt;server&gt; :&lt;branch&gt; //deletes remote branch\n$ git checkout -b test --track origin/test //checkout test branch tracked to test branch locally, create local test branch if not there\n</pre><pre>$ gitk\n$ git commit --interactive\n</pre><pre>$ git cherry-pick</pre><h3><span>Debugging Switcher Bar</span></h3><p>win-tools.git master change (c7a19d4c9440725f741756485ca3b4ad0d8355eb) mocks out the XenGuestAgent code if debugger attached and either: CITRIX_GUI_DEBUGGING environment variable is defined as non-zero Or File named “IAmACitrixGUIDeveloperAndILikeToTest.txt” is in current working directory.</p><h3><span>NIS mount hack on ubuntu</span></h3><p>Add this:</p><pre> ( sleep 15s ; /etc/init.d/autofs restart ) &amp;\n</pre><p>to:</p><pre> /etc/rc.local</pre><h2><span>GRUB Shell</span></h2><p>By default the grub shell is disabled in XT. If you want it back you need to add this to your grub.cfg:</p><pre> set edit_and_shell=1\n</pre><p>Also the grub menu timeout is disabled with:</p><pre> set timeout=-1\n</pre><p>You can fix that up by commenting out that if/fi block and just set a timeout (in seconds):</p><pre> set timeout=5</pre><h2>Core Dumps</h2><p>Enabling core dumps on OpenXT is not working at the moment. There is a ticket:</p><p><ac:structured-macro ac:macro-id=\"2e6cfa5d-ea08-4387-9f26-46fff2f66bbd\" ac:name=\"jira\" ac:schema-version=\"1\"><ac:parameter ac:name=\"server\">JIRA (openxt.atlassian.net)</ac:parameter><ac:parameter ac:name=\"serverId\">87e67eec-7c89-3635-99bf-e58e55630835</ac:parameter><ac:parameter ac:name=\"key\">OXT-902</ac:parameter></ac:structured-macro></p><p>One way around it is to enable them manually from a terminal:</p><pre>$ ulimit -c unlimited</pre><p>In the cases where you need to have them enabled before a daemon starts you can add that to the daemon init script before the call to start it:</p><pre>ulimit -c unlimited &gt;/dev/null 2&gt;&amp;1</pre><p>It seems SELinux must be disabled too. To disable it for every boot, edit <code>/etc/selinix/config</code> and change <code>enforcing</code> to <code>permissive</code>.</p>",
    "date": "2024-11-15",
    "disclaimer": "Users of this benchmark dataset are advised to check Atlassian’s official documentation for the most current information.",
    "space": "DC"
}